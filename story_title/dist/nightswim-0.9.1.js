!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=8)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Obj=n.ObjList=n.Npc=n.NpcList=n.Location=n.LocationList=n.getObj=void 0;var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=t(2),a=t(3),c=t(1);function s(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function r(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var d=new Map,l=new Map,f=new Map,p=function(){function e(n,t,o,i,a,c,s,r,l){return u(this,e),this.name=t,this.accessMsg=o,this.locSnd=a,this.locImg=i,this.cutscenes=c,this.scenes=s,this.content=r,this.styling=l,d.set(n,this),this}return o(e,[{key:"setAccessMsg",value:function(e){return void 0!==e&&"string"==typeof e&&(this.accessMsg=e,!0)}},{key:"setLocImg",value:function(e){return void 0!==e&&"string"==typeof e&&(this.locImg=e,!0)}},{key:"setLocSnd",value:function(e){return void 0!==e&&"string"==typeof e&&(this.locSnd=e,!0)}}]),e}(),v=function(){function e(n,t,o,i,a,c){u(this,e),this.name=n,this.descr=t,this.loc=o,this.state=i,this.interactions=a,this.receive=c}return o(e,[{key:"setInteraction",value:function(e,n){var t=this.interactions[e].activated;return void 0!==t&&"boolean"==typeof t&&void 0!==n&&"boolean"==typeof n&&(t=n,!0)}},{key:"receiveFromObj",value:function(e){for(var n=0,t=!1;n<this.receive.length;){var o=this.receive[n];if(o.from===e){t=!0,(0,c.checkConditions)(o.conditions,!0)&&((0,c.change)(o.consequences),(0,i.showFeedback)(o.feedback));break}n+=1}t||(0,i.showFeedback)("Can't use "+e+" on "+this.name)}}]),e}(),g=function(e){function n(e,t,o,i,a,c,r,d){u(this,n);var f=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i,a,c));return f.comfortLevel=r,f.interactions=a,f.sceneQueue=d,l.set(e,f),s(f,f)}return r(n,v),o(n,[{key:"addScene",value:function(e){var n=void 0;void 0!==e&&"string"==typeof e&&(n="scenes/"+n+".json",$.get(n).done(function(){return sceneQueue.push(e),!0}).fail(function(){return(0,c.logError)("constructor.js/addScene: scenefile not found"),!1}))}},{key:"interact",value:function(e,n){var t=this.interactions[e],o=this.interactions[e].conditions,s=void 0;void 0===n&&(n=!1),(0,c.checkConditions)(o,!0)&&((0,c.change)(t.consequences),"talk"===t.type?this.sceneQueue.length>0&&(s=this.sceneQueue.splice(0,1),(0,c.loadScene)("story/scenes/"+s+".json")):(n||(0,a.openMenu)(c.player.location),(0,i.showFeedback)(t.feedback),this.interactions.splice(e,1)))}}]),n}(),h=function(e){function n(e,t,o,i,a,c,r,d){u(this,n);var l=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i,a,c));return l.content=r,l.singleUse=d,f.set(e,l),s(l,l)}return r(n,v),o(n,[{key:"autoClose",value:function(){for(var e=0;e<this.interactions.length;){var n=this.interactions[e];if("close"===n.type){this.state="closed",n.type="open",n.button="Open "+this.name;var t=this.descr;this.descr=this.content,this.content=t,console.log("auto-closed "+this.name)}e+=1}}},{key:"setInteraction",value:function(e,n){var t=this.interactions[e].activated;return void 0!==t&&"boolean"==typeof t&&void 0!==n&&"boolean"==typeof n&&(t=n,!0)}},{key:"interact",value:function(e,n){var t=this.interactions[e],o=this.interactions[e].conditions,s=!1,r=c.player.location;if(void 0===n&&(n=!1),(0,c.checkConditions)(o,!0)){var u=void 0;switch(t.type){case"open":"closed"===this.state&&(this.state="open",t.type="close",t.button="Close "+this.name,u=this.descr,this.descr=this.content,this.content=u,r=this.name);break;case"close":if("open"===this.state&&(this.state="closed",t.type="open",t.button="Open "+this.name,u=this.descr,this.descr=this.content,this.content=u,a.menuTracker.length>1)){var d=a.menuTracker.length-2;r=a.menuTracker[d]}break;case"take":this.state="taken",this.loc="player",t.activated=!1,t.button="Put "+this.name+" back",c.Inventory.set(this.name,!0);break;case"use on":s=!0}if((0,c.change)(t.consequences),this.singleUse)for(var l=0;l<this.interactions.length;)this.interactions[l].activated=!1,l+=1;n||s?s&&(0,a.useOnMode)(this.name):r===c.player.inventory.name?openInventory():(0,a.openMenu)(r),(0,i.showFeedback)(t.feedback)}}}]),n}();n.default="loaded",n.getObj=function(e){var n=void 0,t=void 0;return(n=l.get(e))instanceof g?t="Npc":(n=f.get(e))instanceof h?t="Obj":(t="unknown",n=null),{type:t,ref:n}},n.LocationList=d,n.Location=p,n.NpcList=l,n.Npc=g,n.ObjList=f,n.Obj=h},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Inventory=n.logError=n.change=n.checkConditions=n.updateDebugStats=n.directAction=n.loadScene=n.refreshLocation=n.enterLocation=n.player=void 0;var o,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=t(6),c=(o=a)&&o.__esModule?o:{default:o},s=t(7),r=t(2),u=t(3),d=t(4),l=t(5),f=t(0),p={},v=!1,g=!1,h=!1,y=!1,b=void 0,m=void 0,k=void 0,T=new Map,L={name:"player",location:"none",locationPrev:"none",locationNext:"none",inObject:!1,inScene:!1,state:"normal",moveToMenu:function(e){L.locationPrev=L.location,L.location=e,L.inObject=!0},leaveMenu:function(e){L.locationPrev=L.location,L.location=e,L.inObject=!1},setLocation:function(e){"locScene"===L.location||L.inObject||(L.locationNext=L.location),L.locationPrev=L.location,L.location=e},setInObject:function(e){L.inObject=!!e}},S=function(){a.soundMuted&&$("#soundInfo").html("muted"),$("#playerlocation").html(L.location),$("#playerprevloc").html(L.locationPrev),$("#playernextloc").html(L.locationNext),$("#inScene").html(L.inScene),$("#inObject").html(L.inObject),$("#menu_active").html((0,u.isMenuActive)()),$("#menu_tracker").html(""),u.menuTracker.forEach(function(e){$("#menu_tracker").append("<li>&gt; "+e+"</li>")})},O=function(e){console.log("ERROR: "+e),$("#err").text("Program error - see console for details")},_=function(e){$.getJSON(e,function(e){(0,l.startScene)(e)}).fail(function(){O("main.js/loadScene: scenefile not loaded: either the file doesn't exist, or there is a syntax-error in the file")})},j=function(e){S();var n,t=f.LocationList.get(e);if("unlocked"!==t.accessMsg)(0,r.showFeedback)(t.accessMsg);else{L.inObject=!1,(0,u.isMenuActive)()&&(0,u.hideMenu)(),(0,r.changeBg)(t),(0,a.changeTrack)(t.locSnd),"In scene"!==t.name&&(L.locationNext=e),L.locationPrev=L.location,L.location=e,L.inScene=!1;for(var o=void 0,i=!1,c=Object.keys(t.cutscenes),l=0;l<c.length&&!i;)o=c[l],t.cutscenes[o]&&(t.cutscenes[o]=!1,n="story/scenes/"+o+".json",$.getJSON(n,function(e){(0,s.startCutscene)(e)}).fail(function(){O("main.js/playCutscene: scenefile not loaded: either the file doesn't exist, or there is a syntax-error in the file")}),i=!0),l+=1;for(c=Object.keys(t.scenes),l=0;l<c.length&&!i;)o=c[l],t.scenes[o]&&(t.scenes[o]=!1,_("story/scenes/"+o+".json"),i=!0),l+=1;if(!i){var p=(0,d.parseLocation)(t.content);L.inScene=!1,(0,r.fadeOut)("text"),(0,r.fadeOut)("choices"),setTimeout(function(){var n="",t=[],o=0,i=void 0;p.forEach(function(e){void 0!==e.delay&&e.delay>0&&(i="delay_"+o,e.sectionHTML='<div id="'+i+'" class="waitForFade">'+e.sectionHTML+"</div>",t.push(e.delay),i+=1),n+=e.sectionHTML}),(0,r.replaceById)("text",n,0,e),(0,u.createButtons)(),(0,r.fadeIn)("text"),(0,r.fadeIn)("choices"),o=0,t.forEach(function(n){var t=o,i=e;setTimeout(function(){L.location===i&&(document.getElementById("delay_"+t).style.opacity=1)},n),o+=1})},r.fadeTime)}}S()},I=function(){var e=L.locationNext,n=f.LocationList.get(e),t="";(0,d.parseLocation)(n.content).forEach(function(e){t+=e.sectionHTML}),(0,r.replaceById)("text",t,0),(0,u.createButtons)(),L.inObject=!1},M=function(){new f.Location("locScene","In scene","locked","no_bg","no_sound",{},{});var e=b.startLocation;L.locationPrev=e,L.locationNext=e,document.onkeydown=function(e){var n=!1,t=!1;void 0!==(e=e||window.event).key?(n="Escape"===e.key||"Esc"===e.key,t=" "===e.key):(n=27===e.keyCode,t=32===e.keyCode),n&&(0,u.isMenuActive)()&&(0,u.hideMenu)(),t&&b.enableInventory&&(L.location===L.inventory.name?(0,u.hideMenu)():(0,u.openInventory)())},L.inventory=new f.Obj("Inventory","Stuff you're carrying around","player","default","<p>Choose an object:</p>",[]),b.enableInventory?$("#inventory").click(u.openInventory):document.getElementById("inventory").style.display="none",b.debugStats&&(document.getElementById("debugstats").style.display="block"),$("#muteButton").click(a.muteSound),document.getElementById("storyTitle").style.display="none",document.querySelector("header").style.opacity=1,p=b.storySettings,(0,r.setBgSize)(b.bgSize),(0,r.setFadeTime)(b.fadeTime),(0,r.setFeedbackTime)(b.feedbackTime);var n=2*r.fadeTime;setTimeout(function(){(0,r.fadeIn)("container",n)},r.fadeTime),j(e)};$(document).ready(function(){console.log("This story is powered by Nightswim 0.9.1"),$.ajaxSetup({beforeSend:function(e){e.overrideMimeType&&e.overrideMimeType("application/json")}}),$.getJSON("story/obj_list.json",function(e){$.each(e,function(e,n){new f.Obj(n.name,n.description,n.location,n.state,n.interactions,n.receive,n.content,n.singleUse)}),v=!0,console.log("Obj's loaded")}).fail(function(){O("Obj's not loaded. This is probably caused by a syntax-error in obj_list.json")}),$.getJSON("story/npc_list.json",function(e){$.each(e,function(e,n){new f.Npc(n.name,n.description,n.location,n.state,n.interactions,n.receive,n.comfortLevel,n.sceneQueue)}),g=!0,console.log("Npc's loaded")}).fail(function(){O("Npc's not loaded. This is probably caused by a syntax-error in npc_list.json")}),$.getJSON("story/locations.json",function(e){var n=setInterval(function(){v&&g&&"loaded"===c.default?(clearInterval(n),$.each(e,function(e,n){new f.Location(n.locID,n.name,n.accessMsg,n.locImg,n.locSnd,n.cutscenes,n.scenes,n.content,n.styling)}),h=!0,console.log("Locations loaded")):console.log("Not yet ready. ObjListLoaded = "+v+", NpcListLoaded = "+g)},100)}).fail(function(){O("Locations not loaded. This is probably caused by a syntax-error in locations.json")}),$.getJSON("story/init.json",function(e){b=e,y=!0}).fail(function(){O("Init settings not loaded. This is probably caused by a syntax-error in init.json")}),m=setInterval(function(){y&&"loaded"===c.default&&(clearInterval(m),b.muteSound&&$("#playSound").text("Turn sound on"),$("#playSound").click(function(){b.muteSound?(b.muteSound=!1,$("#playSound").text("Turn sound off")):(b.muteSound=!0,$("#playSound").text("Turn sound on"))}),b.devAutoStart&&(m=setInterval(function(){h&&y&&"loaded"===c.default&&(clearInterval(m),b.muteSound&&(0,a.muteSound)(),(0,a.setAudioFadeTime)(b.audioFadeTime),Array.isArray(b.preLoadAudio)&&b.preLoadAudio.length>0&&b.preLoadAudio,(0,a.initAudio)(b.preloadAudio),M())},100)))},100),$("#startButton").one("click",function(){b.devAutoStart||(m=setInterval(function(){if(h&&y&&"loaded"===c.default){if(clearInterval(m),b.muteSound&&(0,a.muteSound)(),(0,a.setAudioFadeTime)(b.audioFadeTime),Array.isArray(b.preLoadAudio)&&b.preLoadAudio.length>0&&b.preLoadAudio,(0,a.initAudio)(b.preloadAudio),!b.muteSound){var e=f.LocationList.get(b.startLocation);"no_sound"!==e.locSnd&&(k=(0,a.getAudioTrack)(e.locSnd),(0,a.setCurrentTrack)(k),k.sound.load(),console.log("Loading first audiotrack: "+k.filename),k.sound.volume(1),k.sound.play())}(0,r.fadeOut)("container",r.fadeTime),setTimeout(M,r.fadeTime)}},100))})}),n.default="Main Story Module",n.player=L,n.enterLocation=j,n.refreshLocation=I,n.loadScene=_,n.directAction=function(e){var n=f.ObjList.get(e);n.interactions.length>0&&("talk"===n.interactions[0].type&&(void 0===n.sceneQueue||n.sceneQueue.length<=0||L.inScene)||n.interact(0,!0))},n.updateDebugStats=S,n.checkConditions=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=[],o=!0,i=[],a=0,c=void 0,s=void 0,u=void 0,d=void 0,l=void 0;return e.length>0&&e.forEach(function(e){var n,o=!1;switch(n=void 0!==e.failMsg&&"string"==typeof e.failMsg&&""!==e.failMsg?e.failMsg:"no_msg",s=e.type,u=e.value,void 0!==e.loc&&f.LocationList.get(e.loc)instanceof f.Location&&(l=f.LocationList.get(e.loc)),void 0!==e.npc&&(e.obj=e.npc),void 0!==e.obj&&(d=(0,f.getObj)(e.obj),l=d.ref),s){case"state":l.state===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"inInventory":T.has(l.name)&&(o=!0),o?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"location":l.loc===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"locationAccess":l.accessMsg===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"npcComfortLevel":l.comfortLevel>=u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"storySetting":c=!1,(void 0===e.compare||"equal"!==e.compare&&"larger"!==e.compare&&"smaller"!==e.compare)&&(e.compare="equal"),"equal"===e.compare?u===p[e.storySetting]&&(c=!0):"larger"===e.compare?u>p[e.storySetting]&&(c=!0):"smaller"===e.compare&&u<p[e.storySetting]&&(c=!0),c?t.push(!0):(t.push(!1),i[a]=n,a+=1)}}),!(t.length>0&&(t.forEach(function(e){e||(o=!1)}),!o&&(n&&i.length>0&&(0,r.compositFeedback)(i),1)))},n.change=function(e){var n=!1,t=void 0,o=void 0,a=void 0,c=void 0,s=[],d=0;e.forEach(function(e){switch(e.type){case"addScene":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.scene&&"string"==typeof e.scene&&(n=o.addScene(e.scene));break;case"changeActivation":"unknown"!==(a=(0,f.getObj)(e.obj)).type&&void 0!==e.index&&"number"==typeof e.index&&e.index>=0&&void 0!==e.value&&"boolean"==typeof e.value&&(n=a.ref.setInteraction(e.index,e.value));break;case"changeLoc":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(j(e.loc),(0,l.recordSceneChange)(),n=!0);break;case"changeLocAccess":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setAccessMsg(e.accessMsg));break;case"changeLocBg":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setLocImg(e.file));break;case"changeLocSound":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setLocSnd(e.file));break;case"changeNpcInteraction":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.interaction&&"string"==typeof e.interaction&&(o.interaction=e.interaction,n=!0);break;case"changeObjDescr":(c=f.ObjList.get(e.obj))instanceof f.Obj&&void 0!==e.value&&"string"==typeof e.value&&(c.descr=e.value,n=!0);break;case"changeObjLoc":"unknown"!==(a=(0,f.getObj)(e.obj)).type&&void 0!==e.value&&"string"==typeof e.value&&(a.ref.loc=e.value,n=!0);break;case"changeObjState":(c=f.ObjList.get(e.obj))instanceof f.Obj&&void 0!==e.value&&"string"==typeof e.value&&(c.state=e.value,n=!0);break;case"changePlayerState":void 0!==e.state&&"string"==typeof e.state&&(L.state=e.state,n=!0);break;case"changeSceneState":(t=f.LocationList.get(e.loc))instanceof f.Location&&void 0!==e.scene&&"string"==typeof e.scene&&void 0!==e.activate&&"boolean"==typeof e.activate&&(t.scenes[e.scene]=e.activate,n=!0);break;case"changeStorySetting":void 0!==p[e.storySetting]&&(p[e.storySetting]=e.value,n=!0);break;case"disableChoice":void 0!==e.choice&&"string"==typeof e.choice&&(n=(0,l.disableChoice)(choice));break;case"displayTxt":void 0!==e.txt&&"string"==typeof e.txt&&((0,r.fadeOut)("container"),setTimeout(function(){(0,r.replaceById)("text",e.txt,0),(0,u.addToButtonQueue)("Continue","refresh","refreshLoc"),(0,u.createButtons)(),(0,r.fadeIn)("container")},r.fadeTime),n=!0);break;case"fadeOut":void 0!==e.id&&"string"==typeof e.id&&((0,r.fadeOut)(e.id),n=!0);break;case"increaseNpcComfort":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.amount&&"number"==typeof e.amount&&(o.comfortLevel+=e.amount,n=!0);break;case"refresh":I(),n=!0;break;case"removeSection":void 0!==(t=f.LocationList.get(e.loc))&&void 0!==t.content[e.section]&&"object"===i(t.content[e.section])&&(t.content.splice(e.section,1),n=!0);break;case"triggerCutscene":void 0!==e.cutscene&&"string"==typeof e.cutscene&&(loadCutscene("story/scenes/"+e.scene+".json"),(0,l.recordSceneChange)(),n=!0);break;case"triggerScene":void 0!==e.scene&&"string"==typeof e.scene&&(_("story/scenes/"+e.scene+".json"),(0,l.recordSceneChange)(),n=!0)}n&&void 0!==e.feedback&&"string"==typeof e.feedback?(s[d]=e.feedback,d+=1):n||O("consequence failed: "+e.type)}),s.length>0&&(0,r.compositFeedback)(s)},n.logError=O,n.Inventory=T},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.exitFullscreen=n.enterFullscreen=n.fadeOut=n.fadeIn=n.setFadeTime=n.setFeedbackTime=n.replaceById=n.compositFeedback=n.changeContainerClass=n.clearFeedback=n.showFeedback=n.setBgSize=n.changeBg=n.fadeTime=void 0;var o=t(0),i=t(3),a="contain",c="no_bg",s="std",r="std",u=1e3,d=5e3,l=!1,f=!0,p={bgClass:"std",img:"no_bg"},v={bgClass:"std",img:"no_bg"},g=function(e,n){0!==n&&void 0!==n||(n=u),$("#"+e).fadeTo(n,1)},h=function(e,n){0!==n&&void 0!==n||(n=u),$("#"+e).fadeTo(n,0)},y=function(e){var n=o.LocationList.get(e);if(n instanceof o.Location){var t=n.styling.containerClass;void 0!==t&&""!==t&&"string"==typeof t||(t="std"),t!==r&&($("#container").removeClass(r),$("#container").addClass(t),r=t)}},b=function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none";void 0===t&&0!==t&&(t=u),void 0!==o&&"string"==typeof o||(o="none"),t>0?(h(e,t),setTimeout(function(){$("#"+e).html(n),"none"!==o&&y(o),g(e,t)},t)):("none"!==o&&y(o),$("#"+e).html(n))},m=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="feedback",a=0;(0,i.isMenuActive)()&&(o="menu_"+o),void 0!==e&&"string"==typeof e&&""!==e&&(l&&(a=1e3),setTimeout(function(){l?(document.getElementById(o).style.opacity=0,a=500):a=0,l=!0,setTimeout(function(){b(o,e,0),document.getElementById(o).style.opacity=1,t&&$("#cancelUseOn").one("click",function(){(0,i.deactivateUseOnMode)(!0)}),n||setTimeout(function(){document.getElementById(o).style.opacity=0,l=!1},d)},a)},a))};n.default="loaded",n.fadeTime=u,n.changeBg=function(e){var n=e.locImg,t=e.styling.bgClass;if(void 0!==t&&"string"==typeof t&&""!==t||(t="std"),t!==s||n!==c){var o;c=n,o="no_bg"===n?"none":"story/images/"+n,f?(t!==v.bgClass&&($("#bg_layer_bottom").removeClass(v.bgClass),$("#bg_layer_bottom").addClass(t),v.bgClass=t),n!==v.img&&("none"===o?($("#bg_layer_bottom").css("background","none"),$("#bg_layer_bottom").css({"background-color":""})):($("#bg_layer_bottom").css("background","url('"+o+"') top center no-repeat"),$("#bg_layer_bottom").css({"background-color":""}),$("#bg_layer_bottom").css("background-size",a)),v.img=n),document.getElementById("bg_layer_top").style.opacity=0,f=!1):(t!==p.bgClass&&($("#bg_layer_top").removeClass(p.bgClass),$("#bg_layer_top").addClass(t),p.bgClass=t),n!==p.img&&("none"===o?($("#bg_layer_top").css("background","none"),$("#bg_layer_top").css({"background-color":""})):($("#bg_layer_top").css("background","url('"+o+"') top center no-repeat"),$("#bg_layer_top").css({"background-color":""}),$("#bg_layer_top").css("background-size",a)),p.img=n),document.getElementById("bg_layer_top").style.opacity=1,f=!0),s=t}},n.setBgSize=function(e){a=e},n.showFeedback=m,n.clearFeedback=function(e,n){e&&(document.getElementById("feedback").style.opacity=0),n&&(document.getElementById("menu_feedback").style.opacity=0),l=!1},n.changeContainerClass=y,n.compositFeedback=function(e){var n="",t=!1;if(e.length>0)for(var o=0,i=void 0;o<e.length;)"no_msg"!==(i=e[o])&&(t=!0,n+=i,o<e.length-1&&(n+="<br>")),o++;t&&m(n)},n.replaceById=b,n.setFeedbackTime=function(e){"number"==typeof e&&e>0&&e<5e4&&(d=e)},n.setFadeTime=function(e){"number"==typeof e&&e>0&&e<5e3&&(n.fadeTime=u=e)},n.fadeIn=g,n.fadeOut=h,n.enterFullscreen=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},n.exitFullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.menuTracker=n.useOnModeActive=n.useOnMode=n.hideMenu=n.isMenuActive=n.refreshMenu=n.openMenu=n.openInventory=n.deactivateUseOnMode=n.createButtons=n.addToMenu=n.addToMenuTextQueue=n.addToMenuButtonQueue=n.addToButtonQueue=void 0;var o=t(1),i=t(2),a=t(5),c=t(4),s=t(0),r=[],u=!1,d="none",l=[],f=[],p=[],v=!1,g=!1,h=void 0,y=1,b=function(){return!!u},m=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},k=function(e,n,t,o,i){void 0===o&&(o="no"),void 0===i&&(i=-1),p.push([e,n,t,o,i])},T=function(e){f.push(e)},L=function(e){var n=(0,s.getObj)(e).ref;if(n.interactions.length>0){var t=0,i=!1;n.interactions.forEach(function(n){"take"===n.type&&n.activated&&(i=!0,k(n.button,e,"interact","no",t)),t+=1}),i||(t=0,n.interactions.forEach(function(i){"talk"===i.type&&(void 0===n.sceneQueue||n.sceneQueue.length<=0||o.player.inScene)||!i.activated||k(i.button,e,"interact","no",t),t+=1}))}},S=function(e){"string"==typeof e&&(d=e)},O=function(e){$(e.target).closest("#menu_container").length||b()&&M()},_=function(e,n){for(var t=!1,a=(0,s.getObj)(n),r=!1,u=0,p=0;u<l.length;){if(l[u]===n){t=!0;var v=l.length-1;if(u<v){var g=u+1,h=v-u;l.splice(g,h)}}u+=1}for(t||l.push(n);p<a.ref.interactions.length;){if("close"===a.ref.interactions[p].type){r=!0;break}p+=1}if(l.length>1){var y=l.length-2,b=l[y];r||(b===o.player.inventory.name?k("Back",b,"openInventory","no",-1):k("Back",b,"openMenu","no",-1))}e>0&&((0,i.fadeOut)("menu_info",e),(0,i.fadeOut)("menu_options",e)),setTimeout(function(){(0,i.replaceById)("menu_options","",0),(0,i.replaceById)("menu_title",d,0),(0,i.replaceById)("menu_info","",0),f.forEach(function(e){$("#menu_info").append("<p>"+(0,c.parse)(e)+"</p>")}),k("Close menu","closeButton","hideMenu"),B(),(0,o.updateDebugStats)(),e>0&&((0,i.fadeIn)("menu_info",e),(0,i.fadeIn)("menu_options",e))},e)},j=function(e){_(i.fadeTime/4,e)},I=function(e){u=!0,v=!0,(0,i.clearFeedback)(!1,!0),_(0,e),$("#menu_container").removeClass("hide"),setTimeout(function(){$("#menu_container").addClass("animate"),$("#container").addClass("blur")},50),setTimeout(function(){document.addEventListener("mouseup",O),v=!1},500)},M=function(){if(v=!0,document.removeEventListener("mouseup",O),$("#menu_container").removeClass("animate"),$("#container").removeClass("blur"),setTimeout(function(){v=!1,u||$("#menu_container").addClass("hide")},200),l.length>1)for(var e=1;e<l.length;)(0,s.getObj)(l[e]).ref.autoClose(),e+=1;u=!1,n.menuTracker=l=[],(0,o.updateDebugStats)(),o.player.inObject&&!o.player.inScene?(o.player.leaveMenu(o.player.locationNext),(0,o.updateDebugStats)(),(0,o.refreshLocation)()):o.player.inObject&&o.player.inScene&&(o.player.leaveMenu("locScene"),(0,o.updateDebugStats)())},x=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];g&&(n.useOnModeActive=g=!1,(0,i.clearFeedback)(!0,!0),(0,i.showFeedback)("'Use on' cancelled"),e&&(0,o.refreshLocation)())},C=function(e){var n=(0,s.getObj)(e).ref;setTimeout(function(){o.player.moveToMenu(e),void 0!==n&&(S(m(n.name)),T(n.descr),L(e),b()?j(e):I(e))},v?250:0)},A=function(){var e=void 0,n=o.player.inventory.name,t=s.ObjList.get(n);setTimeout(function(){o.player.moveToMenu(n),S(m(n)),T(t.descr),o.Inventory.forEach(function(n,t,o){n&&(e=s.ObjList.get(t),k(e.name,e.name,"openMenu","no",-1))}),b()?j(n):I(n),g&&x()},v?250:0)},B=function(){var e="choices",t=r;u&&(e="menu_options",t=p),(0,i.replaceById)(e,"",0),t.forEach(function(t){var c,r=t[0],u=t[1],d=t[2],l=t[3],f=t[4],p="std";c="no"===l||"string"!=typeof l?"btn"+y:l,y+=1;var v=s.LocationList.get(o.player.locationNext).styling.buttonClass;void 0!==v&&"string"==typeof v&&""!==v&&(p=v),"inline_button"!==r?(r=m(r),$("#"+e).append('<li><button id="'+c+'" class="'+p+'">'+r+"</button></li>")):!g||"directAction"!==d&&"openMenu"!==d||(d="useOn"),"changeLoc"===d?$("#"+c).click(function(){x(),(0,o.enterLocation)(u)}):"advanceScene"===d?$("#"+c).one("click",function(){x(),(0,a.advanceScene)(u)}):"hideMenu"===d?$("#"+c).one("click",function(){x(),M()}):"openMenu"===d?$("#"+c).click(function(){x(),C(u)}):"openInventory"===d?$("#"+c).one("click",function(){x(),A()}):"interact"===d?$("#"+c).click(function(){x();var e=s.ObjList.get(u);void 0===e&&(e=s.NpcList.get(u)),f>=0&&e.interact(f,!1)}):"directAction"===d?$("#"+c).click(function(){x(),(0,o.directAction)(u)}):"directChange"===d?$("#"+c).click(function(){x(),(0,o.change)(u)}):"refreshLoc"===d?$("#"+c).one("click",function(){x(),(0,o.refreshLocation)()}):"useOn"===d&&$("#"+c).one("click",function(){var e=s.ObjList.get(u);void 0===e&&(e=s.NpcList.get(u)),(0,i.clearFeedback)(!0,!0),e.receiveFromObj(h),n.useOnModeActive=g=!1,(0,o.refreshLocation)()})}),u?(f=[],p=[]):r=[]};n.default="loaded",n.addToButtonQueue=function(e,n,t,o,i){void 0===o&&(o="no"),void 0===i&&(i=-1),r.push([e,n,t,o,i])},n.addToMenuButtonQueue=k,n.addToMenuTextQueue=T,n.addToMenu=L,n.createButtons=B,n.deactivateUseOnMode=x,n.openInventory=A,n.openMenu=C,n.refreshMenu=j,n.isMenuActive=b,n.hideMenu=M,n.useOnMode=function(e){n.useOnModeActive=g=!0,h=e,M(),(0,i.showFeedback)('<a href="#" id="cancelUseOn">cancel</a> Use '+h+" on:",!0,!0)},n.useOnModeActive=g,n.menuTracker=l},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseLocation=n.parse=void 0;var o=t(3),i=t(0),a=t(1),c=1,s=void 0,r=function(e){var n=!1,t=!1,a=!1,r=void 0,u=void 0,d=void 0,l=void 0,f=void 0,p=void 0,v={buttonTxt:"none",strt:0,end:0,lngth:0},g={objID:"none",strt:0,end:0,lngth:0};do{if(n=!1,t||(u=e.search(/\[{2}/),d=e.search(/\]{2}/)+2,u>-1&&d>1&&d>u?(l=d-u,f=e.substr(u,l),v.end=f.search(/->/),v.end>-1?(n=!0,g.strt=v.end+2,v.lngth=v.end-2,g.end=f.search(/\]{2}/),g.lngth=g.end-g.strt,v.buttonTxt=f.substr(2,v.lngth),g.objID=f.substr(g.strt,g.lngth),(0,o.isMenuActive)()?(0,o.addToMenuButtonQueue)(v.buttonTxt,g.objID,"changeLoc","no",-1):(0,o.addToButtonQueue)(v.buttonTxt,g.objID,"changeLoc","no",-1),e=e.replace(f,"")):t=!0):t=!0),!a)if(r=!1,u=e.search(/\{{2}/),d=e.search(/\}{2}/)+2,u>-1&&d>1&&d>u){if(n=!0,l=d-u,f=e.substr(u,l),v.strt=2,2===f.search(/\!/)&&(r=!0,v.strt+=1),v.end=f.search(/->/),-1===v.end||void 0===v.end?(v.end=f.search(/\}{2}/),v.lngth=v.end-v.strt,g.objID=f.substr(v.strt,v.lngth)):(g.strt=v.end+2,g.end=f.search(/\}{2}/),g.lngth=g.end-g.strt,g.objID=f.substr(g.strt,g.lngth)),v.lngth=v.end-v.strt,v.buttonTxt=f.substr(v.strt,v.lngth),(0,o.isMenuActive)()){var h=i.ObjList.get(g.objID),y=i.NpcList.get(g.objID);void 0!==y&&(h=y),void 0!==h&&("player"!==h.loc?(p=v.buttonTxt,(0,o.addToMenu)(g.objID)):p="")}else s="inlBtn"+c,c+=1,p=o.useOnModeActive?'<a href="#" id='+s+' class="useOn">'+v.buttonTxt+"</a>":'<a href="#" id='+s+">"+v.buttonTxt+"</a>",r?(0,o.addToButtonQueue)("inline_button",g.objID,"directAction",s,-1):(0,o.addToButtonQueue)("inline_button",g.objID,"openMenu",s,-1);e=e.replace(f,p)}else a=!0}while(n);return e};n.default="loaded",n.parse=r,n.parseLocation=function(e){var n=[];return e.forEach(function(e){var t=void 0,i=void 0,u=void 0,d=void 0,l=void 0,f=e.sectionHTML,p=void 0,v=void 0,g=!1,h=!1;if(e.conditions.length>0&&(u=f.search(/\({2}/),d=f.search(/\){2}/),u>-1&&d>1&&d>u?(l=(d+=2)-u,t=f.substr(u,l),l=(d-=2)-(u+=2),p=f.substr(u,l)):(p=f,t=f,g=!0),(0,a.checkConditions)(e.conditions)?f=f.replace(t,p):(f=f.replace(t,""),g&&(h=!0,void 0!==e.fallback&&""!==e.fallback&&(f=e.fallback)))),e.consequences.length>0&&!h&&(u=-1,d=-1,u=f.search(/\(\{/),d=f.search(/\}\)/),u>-1&&d>1&&d>u?(l=(d+=2)-u,i=f.substr(u,l),l=(d-=2)-(u+=2),v=f.substr(u,l)):(v=f,i=f),v.length>0)){s="inlBtn"+c,c+=1;var y='<a href="#" id='+s+">"+v+"</a>";f=f.replace(i,y),(0,o.addToButtonQueue)("inline_button",e.consequences,"directChange",s,-1)}f=r(f);var b=0;void 0!==e.delay&&"number"==typeof e.delay&&e.delay>0&&(b=e.delay);var m={sectionHTML:f,delay:b};n.push(m)}),n}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.advanceScene=n.startScene=n.disableChoice=n.recordSceneChange=n.sceneChanged=void 0;var o=t(1),i=t(2),a=t(3),c=t(0),s=t(4),r=!1,u={},d=function(e){var n,t=!1,d=!1,l=void 0;if((0,o.updateDebugStats)(),(0,a.isMenuActive)()&&(0,a.hideMenu)(),o.player.inScene=!0,(0,o.updateDebugStats)(),(0,i.fadeOut)("text"),(0,i.fadeOut)("choices"),(n=u[e].responses).length>0){for(var f=0,p=void 0;f<n.length&&!t;)void 0!==(p=n[f].conditions)?(0,o.checkConditions)(p,!1)&&(l=n[f],t=!0):t=!0,f+=1;t&&(setTimeout(function(){(0,i.replaceById)("text",(0,s.parse)(l.response),0,o.player.locationNext)},i.fadeTime),"string"==typeof l.response&&""!==l.response&&(d=!0))}if("start"!==e){var v=u[e].consequences;(0,o.change)(v)}if((0,o.updateDebugStats)(),o.player.location!==o.player.locationNext&&!r&&o.player.inScene)if(t){var g=l.newChoices;if(0===g.length&&d){var h=o.player.locationNext;(0,a.addToButtonQueue)("Continue",h,"changeLoc",h),setTimeout(function(){(0,a.createButtons)()},i.fadeTime)}else g.forEach(function(e){u[e].enabled&&(0,a.addToButtonQueue)(u[e].choice,e,"advanceScene",e)}),setTimeout(function(){(0,a.createButtons)()},i.fadeTime);setTimeout(function(){(0,i.fadeIn)("text"),(0,i.fadeIn)("choices")},i.fadeTime)}else"In scene"===c.LocationList.get(o.player.location).name&&(0,o.enterLocation)(o.player.locationNext)};n.default="loaded",n.sceneChanged=r,n.recordSceneChange=function(){n.sceneChanged=r=!0},n.disableChoice=function(e){return void 0!==u[e].enabled&&"boolean"==typeof u[e].enabled?(u[e].enabled=!1,!0):(console.log("Error: scene.js/disableChoice: choice not found"),!1)},n.startScene=function(e){o.player.setLocation("locScene"),o.player.setInObject(!1),u=e,n.sceneChanged=r=!1,d("start")},n.advanceScene=d},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createSoundObj=n.getAudioTrack=n.soundMuted=n.setCurrentTrack=n.setAudioFadeTime=n.muteSound=n.initAudio=n.changeTrack=n.isPlayingAudio=void 0;var o=t(2),i=t(1),a=t(0),c=!1,s=[],r={filename:"no_sound"},u=!1,d=1e3,l=function(){r.sound.volume(0),r.sound.play(),r.sound.fade(0,1,d),$("#soundInfo").text("playing "+r.filename),n.isPlayingAudio=u=!0},f=function(){var e=r;$("#soundInfo").text("fading out"),"no_sound"!==e.filename&&(e.sound.fade(1,0,d),setTimeout(function(){e.sound.pause(),$("#soundInfo").text("playback paused")},d)),n.isPlayingAudio=u=!1},p=function(e){var n=r;r=e,c||r.sound.play(),$("#soundInfo").text("track changed: "+e.filename),console.log("Starting playback for "+r.filename),c||n.filename===e.filename||"no_sound"===n.filename?c||n.filename===e.filename||"no_sound"!==n.filename?c&&n.filename!==e.filename&&$("#soundInfo").text("sound is muted, only updated currentTrack"):($("#soundInfo").text("fade in"),l()):(n.sound.fade(1,0,d),r.sound.fade(0,1,d),setTimeout(function(){n.sound.pause()},2e3))};n.default="loaded",n.isPlayingAudio=u,n.changeTrack=function(e){if(e!==r.filename)if("no_sound"!==e){for(var n=!1,t=void 0,o=0;o<s.length&&!n;)s[o].filename===e&&(n=!0,t=o),o+=1;if(n&&!c){var a=s[t];"unloaded"===a.sound.state()?(a.sound.load(),a.sound.once("load",function(){p(a)})):"loading"===a.sound.state()?a.sound.once("load",function(){p(a)}):p(a)}else n&&c&&(r=s[t])}else c||f(),setTimeout(function(){r={filename:"no_sound",audioElement:null},(0,i.updateDebugStats)(),$("#soundInfo").text("playback stopped")},d)},n.initAudio=function(e){a.LocationList.forEach(function(n){var t=!1;if("no_sound"!==n.locSnd){var o=!1;if(s.forEach(function(e){e.filename===n.locSnd&&(o=!0)}),!o){var i="story/audio/"+n.locSnd;c||e.forEach(function(e){i===(e="story/audio/"+e)&&(t=!0,console.log("Preloading "+i))});var a=new Howl({src:[i],loop:!0,volume:0,preload:t}),r={filename:n.locSnd,sound:a};s.push(r)}}})},n.muteSound=function(){c?(n.soundMuted=c=!1,"no_sound"!==r.filename&&("loaded"===r.sound.state()?l():(r.sound.load(),r.sound.once("load",function(){l()}))),(0,o.replaceById)("muteButton","Mute sound")):(n.soundMuted=c=!0,"no_sound"!==r.filename&&f(),(0,o.replaceById)("muteButton","Unmute sound"))},n.setAudioFadeTime=function(e){"number"==typeof e&&e>=0&&(d=e)},n.setCurrentTrack=function(e){r=e,n.isPlayingAudio=u=!0,$("#soundInfo").text("playing: "+r.filename)},n.soundMuted=c,n.getAudioTrack=function(e){for(var n=!1,t=void 0;0<s.length&&!n;)s[0].filename===e&&(n=!0,t=0);return n?s[t]:null},n.createSoundObj=function(e,n){return c&&(n=!1),new Howl({src:[e],loop:!1,volume:1,preload:n})}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.startCutscene=void 0;var o=t(6),i=t(0),a=t(2),c=t(1);n.default="loaded",n.startCutscene=function(e){(0,a.fadeOut)("text",a.fadeTime),(0,a.fadeOut)("choices",a.fadeTime),e.forEach(function(e){if("no_sound"!==e.playSoundfile){var n="story/audio/"+e.playSoundfile;e.soundObj=(0,o.createSoundObj)(n,!0)}}),c.player.setLocation("locScene"),c.player.setInObject(!1),setTimeout(function(){$("#text").html(""),$("#choices").html(""),(0,a.fadeIn)("text",0),(0,a.fadeIn)("choices",0),(0,a.changeContainerClass)(c.player.locationNext),function e(n,t){var o="event_"+t.indexOf(n),s=n.duration+n.inAnim;if("no_sound"!==n.playSoundfile&&n.soundObj.play(),"add"===n.type)n.inAnim>=0&&($('<div id="'+o+'" class="cutscene">'+n.sectionHTML+"</div>").appendTo("#text").hide(),$("#"+o).fadeIn(n.inAnim));else{var r='<div id="'+o+'" class="cutscene">'+n.sectionHTML+"</div>";n.inAnim>0?((0,a.fadeOut)("text",0),$("#text").html(r),(0,a.fadeIn)("text",n.inAnim)):$("#text").html(r)}setTimeout(function(){n.outAnim>0?$("#"+o).fadeOut(n.outAnim):0===n.outAnim&&$("#"+o).remove(),"fadeOutAll"===n.onEnd&&(0,a.replaceById)("text","",a.fadeTime),setTimeout(function(){var o=t.indexOf(n);o<t.length-1?e(t[o+1],t):"In scene"===i.LocationList.get(c.player.location).name&&(0,c.enterLocation)(c.player.locationNext)},n.outAnim)},s)}(e[0],e)},a.fadeTime)}},function(e,n,t){e.exports=t(1)}]);