!function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=8)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Obj=n.ObjList=n.Npc=n.NpcList=n.Location=n.LocationList=n.getObj=void 0;var o=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),i=t(3),a=t(2),c=t(1);function s(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function r(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}function u(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var d=new Map,l=new Map,f=new Map,v=function(){function e(n,t,o,i,a,c,s,r,l){return u(this,e),this.name=t,this.accessMsg=o,this.locSnd=a,this.locImg=i,this.cutscenes=c,this.scenes=s,this.content=r,this.styling=l,this.visited=!1,d.set(n,this),this}return o(e,[{key:"setAccessMsg",value:function(e){return void 0!==e&&"string"==typeof e&&(this.accessMsg=e,!0)}},{key:"setLocImg",value:function(e){return void 0!==e&&"string"==typeof e&&(this.locImg=e,!0)}},{key:"setLocSnd",value:function(e){return void 0!==e&&"string"==typeof e&&(this.locSnd=e,!0)}},{key:"visit",value:function(){this.visited=!0}},{key:"getVisited",value:function(){return this.visited}}]),e}(),p=function(){function e(n,t,o,i,a,c){u(this,e),this.name=n,this.descr=t,this.loc=o,this.state=i,this.interactions=a,this.receive=c}return o(e,[{key:"setInteraction",value:function(e,n){var t=this.interactions[e].activated;return void 0!==t&&"boolean"==typeof t&&void 0!==n&&"boolean"==typeof n&&(t=n,!0)}},{key:"setDescr",value:function(e){return void 0!==e&&"string"==typeof e&&""!==e&&(this.descr=e,!0)}},{key:"setLoc",value:function(e){var n=d.get(e);return void 0!==n&&n instanceof v&&(this.loc=e,!0)}},{key:"setState",value:function(e){return void 0!==e&&"string"==typeof e&&""!==e&&(this.state=e,!0)}},{key:"receiveFromObj",value:function(e){for(var n=0,t=!1;n<this.receive.length;){var o=this.receive[n];if(o.from===e){t=!0,(0,c.checkConditions)(o.conditions,!0)&&((0,c.change)(o.consequences),(0,i.addFeedback)(o.feedback));break}n+=1}t||(0,i.addFeedback)("Can't use "+e+" on "+this.name)}}]),e}(),h=function(e){function n(e,t,o,i,a,c,r,d){u(this,n);var f=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i,a,c));return f.comfortLevel=r,f.interactions=a,f.sceneQueue=d,l.set(e,f),s(f,f)}return r(n,p),o(n,[{key:"addScene",value:function(e){var n=void 0;void 0!==e&&"string"==typeof e&&(n="scenes/"+n+".json",$.get(n).done(function(){return sceneQueue.push(e),!0}).fail(function(){return(0,c.logError)("constructor.js/addScene: scenefile not found"),!1}))}},{key:"interact",value:function(e,n){var t=this.interactions[e],o=this.interactions[e].conditions,s=void 0;void 0===n&&(n=!1),(0,c.checkConditions)(o,!0)&&((0,c.change)(t.consequences),"talk"===t.type?this.sceneQueue.length>0&&(s=this.sceneQueue.splice(0,1),(0,c.loadScene)("story/scenes/"+s+".json")):(n||(0,a.openMenu)(c.player.location),(0,i.addFeedback)(t.feedback),this.interactions.splice(e,1)))}}]),n}(),g=function(e){function n(e,t,o,i,a,c,r,d){u(this,n);var l=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t,o,i,a,c));return l.content=r,l.singleUse=d,f.set(e,l),s(l,l)}return r(n,p),o(n,[{key:"autoClose",value:function(){for(var e=0;e<this.interactions.length;){var n=this.interactions[e];if("close"===n.type){this.state="closed",n.type="open",n.button="Open "+this.name;var t=this.descr;this.descr=this.content,this.content=t,console.log("auto-closed "+this.name)}e+=1}}},{key:"setInteraction",value:function(e,n){var t=this.interactions[e].activated;return void 0!==t&&"boolean"==typeof t&&void 0!==n&&"boolean"==typeof n&&(t=n,!0)}},{key:"interact",value:function(e,n){var t=this.interactions[e],o=this.interactions[e].conditions,s=!1,r=c.player.location;if(void 0===n&&(n=!1),(0,c.checkConditions)(o,!0)){var u=void 0;switch(t.type){case"open":"closed"===this.state&&(this.state="open",t.type="close",t.button="Close "+this.name,u=this.descr,this.descr=this.content,this.content=u,r=this.name);break;case"close":if("open"===this.state&&(this.state="closed",t.type="open",t.button="Open "+this.name,u=this.descr,this.descr=this.content,this.content=u,a.menuTracker.length>1)){var d=a.menuTracker.length-2;r=a.menuTracker[d]}break;case"take":this.state="taken",this.loc="player",t.activated=!1,t.button="Put "+this.name+" back",c.Inventory.set(this.name,!0);break;case"use on":s=!0}if((0,c.change)(t.consequences),this.singleUse)for(var l=0;l<this.interactions.length;)this.interactions[l].activated=!1,l+=1;n||s?s&&(0,a.useOnMode)(this.name):r===c.player.inventory.name?openInventory():(0,a.openMenu)(r),(0,i.addFeedback)(t.feedback)}}}]),n}();n.default="loaded",n.getObj=function(e){var n=void 0,t=void 0;return(n=l.get(e))instanceof h?t="Npc":(n=f.get(e))instanceof g?t="Obj":(t="unknown",n=null),{type:t,ref:n}},n.LocationList=d,n.Location=v,n.NpcList=l,n.Npc=h,n.ObjList=f,n.Obj=g},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Inventory=n.logError=n.change=n.checkConditions=n.updateDebugStats=n.directAction=n.loadScene=n.refreshLocation=n.enterLocation=n.player=void 0;var o,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=t(6),c=(o=a)&&o.__esModule?o:{default:o},s=t(7),r=t(3),u=t(2),d=t(4),l=t(5),f=t(0),v={},p=!1,h=!1,g=!1,y=!1,m=void 0,b=void 0,k=void 0,S=new Map,T={name:"player",location:"none",locationPrev:"none",locationNext:"none",inObject:!1,inScene:!1,state:"normal",moveToMenu:function(e){T.locationPrev=T.location,T.location=e,T.inObject=!0},leaveMenu:function(e){T.locationPrev=T.location,T.location=e,T.inObject=!1},setLocation:function(e){"locScene"===T.location||T.inObject||(T.locationNext=T.location),T.locationPrev=T.location,T.location=e},setInObject:function(e){T.inObject=!!e}},_=function(){a.soundMuted&&$("#soundInfo").html("muted"),$("#playerlocation").html(T.location),$("#playerprevloc").html(T.locationPrev),$("#playernextloc").html(T.locationNext),$("#inScene").html(T.inScene),$("#inObject").html(T.inObject),$("#menu_active").html((0,u.isMenuActive)()),$("#menu_tracker").html(""),u.menuTracker.forEach(function(e){$("#menu_tracker").append("<li>&gt; "+e+"</li>")})},L=function(e){console.log("ERROR: "+e),$("#err").text("Program error - see console for details")},O=function(e){$.getJSON(e,function(e){(0,l.startScene)(e)}).fail(function(){L("main.js/loadScene: scenefile not loaded: either the file doesn't exist, or there is a syntax-error in the file")})},j=function(e){_();var n,t=f.LocationList.get(e);if("unlocked"!==t.accessMsg)(0,r.addFeedback)(t.accessMsg);else{T.inObject=!1,(0,u.isMenuActive)()&&(0,u.hideMenu)(),(0,r.changeBg)(t),(0,a.changeTrack)(t.locSnd),"In scene"!==t.name&&(T.locationNext=e),T.locationPrev=T.location,T.location=e,T.inScene=!1,t.visit();for(var o=void 0,i=!1,c=Object.keys(t.cutscenes),l=0;l<c.length&&!i;)o=c[l],t.cutscenes[o]&&(t.cutscenes[o]=!1,n="story/scenes/"+o+".json",$.getJSON(n,function(e){(0,s.startCutscene)(e)}).fail(function(){L("main.js/playCutscene: scenefile not loaded: either the file doesn't exist, or there is a syntax-error in the file")}),i=!0),l+=1;for(c=Object.keys(t.scenes),l=0;l<c.length&&!i;)o=c[l],t.scenes[o]&&(t.scenes[o]=!1,O("story/scenes/"+o+".json"),i=!0),l+=1;if(!i){var v=(0,d.parseLocation)(t.content);T.inScene=!1,(0,r.fadeOut)("text"),(0,r.fadeOut)("choices"),setTimeout(function(){var n="",t=[],o=0,i=void 0;v.forEach(function(e){void 0!==e.delay&&e.delay>0&&(i="delay_"+o,e.sectionHTML='<div id="'+i+'" class="waitForFade">'+e.sectionHTML+"</div>",t.push(e.delay),i+=1),n+=e.sectionHTML}),(0,r.replaceById)("text",n,0,e),(0,u.createButtons)(),(0,r.fadeIn)("text"),(0,r.fadeIn)("choices"),o=0,t.forEach(function(n){var t=o,i=e;setTimeout(function(){T.location===i&&(document.getElementById("delay_"+t).style.opacity=1)},n),o+=1})},r.fadeTime)}}_()},I=function(){var e=T.locationNext,n=f.LocationList.get(e),t="";(0,d.parseLocation)(n.content).forEach(function(e){t+=e.sectionHTML}),(0,r.replaceById)("text",t,0),(0,u.createButtons)(),T.inObject=!1},M=function(){new f.Location("locScene","In scene","locked","no_bg","no_sound",{},{});var e=m.startLocation;T.locationPrev=e,T.locationNext=e,document.onkeydown=function(e){var n=!1,t=!1;void 0!==(e=e||window.event).key?(n="Escape"===e.key||"Esc"===e.key,t=" "===e.key):(n=27===e.keyCode,t=32===e.keyCode),n&&(0,u.isMenuActive)()&&(0,u.hideMenu)(),t&&m.enableInventory&&(T.location===T.inventory.name?(0,u.hideMenu)():(0,u.openInventory)())},T.inventory=new f.Obj("Inventory","Stuff you're carrying around","player","default","<p>Choose an object:</p>",[]),m.enableInventory?$("#inventoryBtn").on("click",function(){(0,u.openInventory)()}):document.getElementById("inventoryBtn").style.display="none",m.debugStats&&(document.getElementById("debugstats").style.display="block"),$("#soundBtn").click(a.muteSound),$("#fsBtn").click(r.toggleFullscreen),document.getElementById("storyTitle").style.display="none",document.querySelector("header").style.opacity=1,v=m.storySettings,(0,r.setBgSize)(m.bgSize),(0,r.setFadeTime)(m.fadeTime),(0,r.setFeedbackTime)(m.feedbackTime);var n=2*r.fadeTime;setTimeout(function(){(0,r.fadeIn)("container",n)},r.fadeTime),j(e)};$(document).ready(function(){console.log("This story is powered by Nightswim 0.9.4"),$.ajaxSetup({beforeSend:function(e){e.overrideMimeType&&e.overrideMimeType("application/json")}}),$.getJSON("story/obj_list.json",function(e){$.each(e,function(e,n){new f.Obj(n.name,n.description,n.location,n.state,n.interactions,n.receive,n.content,n.singleUse)}),p=!0,console.log("Obj's loaded")}).fail(function(){L("Obj's not loaded. This is probably caused by a syntax-error in obj_list.json")}),$.getJSON("story/npc_list.json",function(e){$.each(e,function(e,n){new f.Npc(n.name,n.description,n.location,n.state,n.interactions,n.receive,n.comfortLevel,n.sceneQueue)}),h=!0,console.log("Npc's loaded")}).fail(function(){L("Npc's not loaded. This is probably caused by a syntax-error in npc_list.json")}),$.getJSON("story/locations.json",function(e){var n=setInterval(function(){p&&h&&"loaded"===c.default?(clearInterval(n),$.each(e,function(e,n){new f.Location(n.locID,n.name,n.accessMsg,n.locImg,n.locSnd,n.cutscenes,n.scenes,n.content,n.styling)}),g=!0,console.log("Locations loaded")):console.log("Not yet ready. ObjListLoaded = "+p+", NpcListLoaded = "+h)},100)}).fail(function(){L("Locations not loaded. This is probably caused by a syntax-error in locations.json")}),$.getJSON("story/init.json",function(e){m=e,y=!0}).fail(function(){L("Init settings not loaded. This is probably caused by a syntax-error in init.json")}),b=setInterval(function(){y&&"loaded"===c.default&&(clearInterval(b),m.muteSound&&$("#playSound").text("Turn sound on"),$("#playSound").click(function(){m.muteSound?(m.muteSound=!1,$("#playSound").text("Turn sound off")):(m.muteSound=!0,$("#playSound").text("Turn sound on"))}),m.devAutoStart&&(b=setInterval(function(){g&&y&&"loaded"===c.default&&(clearInterval(b),m.muteSound&&(0,a.muteSound)(),(0,a.setAudioFadeTime)(m.audioFadeTime),Array.isArray(m.preLoadAudio)&&m.preLoadAudio.length>0&&m.preLoadAudio,(0,a.initAudio)(m.preloadAudio),M())},100)))},100),$("#startButton").one("click",function(){m.devAutoStart||(b=setInterval(function(){if(g&&y&&"loaded"===c.default){if(clearInterval(b),m.muteSound&&(0,a.muteSound)(),(0,a.setAudioFadeTime)(m.audioFadeTime),Array.isArray(m.preLoadAudio)&&m.preLoadAudio.length>0&&m.preLoadAudio,(0,a.initAudio)(m.preloadAudio),!m.muteSound){var e=f.LocationList.get(m.startLocation);"no_sound"!==e.locSnd&&(k=(0,a.getAudioTrack)(e.locSnd),(0,a.setCurrentTrack)(k),k.howl.load(),console.log("Loading first audiotrack: "+k.filename),k.howl.volume(1),k.howl.play())}(0,r.fadeOut)("container",r.fadeTime),setTimeout(M,r.fadeTime)}},100))})}),n.default="Main Story Module",n.player=T,n.enterLocation=j,n.refreshLocation=I,n.loadScene=O,n.directAction=function(e){var n=f.ObjList.get(e);n.interactions.length>0&&("talk"===n.interactions[0].type&&(void 0===n.sceneQueue||n.sceneQueue.length<=0||T.inScene)||n.interact(0,!0))},n.updateDebugStats=_,n.checkConditions=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=[],o=!0,i=[],a=0,c=void 0,s=void 0,u=void 0,d=void 0,l=void 0,p=void 0;return e.length>0&&e.forEach(function(e){var n,o=!1;switch(n=void 0!==e.failMsg&&"string"==typeof e.failMsg&&""!==e.failMsg?e.failMsg:"no_msg",s=e.type,u=e.value,void 0!==e.loc&&(d=f.LocationList.get(e.loc),p=d instanceof f.Location?d:"no_location"),void 0!==e.npc&&(e.obj=e.npc),void 0!==e.obj&&(l=(0,f.getObj)(e.obj),p=l.ref),s){case"inInventory":S.has(p.name)&&(o=!0),o?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"location":p.loc===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"locationAccess":p.accessMsg===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"npcComfortLevel":p.comfortLevel>=u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"state":p.state===u?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"storySetting":c=!1,(void 0===e.compare||"equal"!==e.compare&&"larger"!==e.compare&&"smaller"!==e.compare)&&(e.compare="equal"),"equal"===e.compare?u===v[e.storySetting]&&(c=!0):"larger"===e.compare?u>v[e.storySetting]&&(c=!0):"smaller"===e.compare&&u<v[e.storySetting]&&(c=!0),c?t.push(!0):(t.push(!1),i[a]=n,a+=1);break;case"visited":"no_location"!==p?p.getVisited()?t.push(!0):(t.push(!1),i[a]=n,a+=1):(t.push(!1),i[a]=n,L("invalid locID specified for visited-condition"),a+=1)}}),!(t.length>0&&(t.forEach(function(e){e||(o=!1)}),!o&&(n&&i.length>0&&(0,r.compositFeedback)(i),1)))},n.change=function(e){var n=!1,t=void 0,o=void 0,c=void 0,s=void 0,d=void 0,p=[],h=0;e.forEach(function(e){switch(e.type){case"addScene":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.scene&&"string"==typeof e.scene&&(n=o.addScene(e.scene));break;case"changeActivation":"unknown"!==(c=(0,f.getObj)(e.obj)).type&&void 0!==e.index&&"number"==typeof e.index&&e.index>=0&&void 0!==e.value&&"boolean"==typeof e.value&&(n=c.ref.setInteraction(e.index,e.value));break;case"changeLoc":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(j(e.loc),(0,l.recordSceneChange)(),n=!0);break;case"changeLocAccess":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setAccessMsg(e.accessMsg));break;case"changeLocBg":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setLocImg(e.file));break;case"changeLocSound":void 0!==(t=f.LocationList.get(e.loc))&&t instanceof f.Location&&(n=t.setLocSnd(e.file));break;case"changeNpcInteraction":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.interaction&&"string"==typeof e.interaction&&(o.interaction=e.interaction,n=!0);break;case"changeObjDescr":"unknown"!==(c=(0,f.getObj)(e.obj)).type&&(n=c.ref.setDescr(e.value));break;case"changeObjLoc":"unknown"!==(c=(0,f.getObj)(e.obj)).type&&(n=c.ref.setLoc(e.value));break;case"changeObjState":"unknown"!==(c=(0,f.getObj)(e.obj)).type&&(n=c.ref.setState(e.value));break;case"changePlayerState":void 0!==e.state&&"string"==typeof e.state&&(T.state=e.state,n=!0);break;case"changeSceneState":(t=f.LocationList.get(e.loc))instanceof f.Location&&void 0!==e.scene&&"string"==typeof e.scene&&void 0!==e.activate&&"boolean"==typeof e.activate&&(t.scenes[e.scene]=e.activate,n=!0);break;case"changeStorySetting":void 0!==v[e.storySetting]&&(v[e.storySetting]=e.value,n=!0);break;case"disableChoice":void 0!==e.choice&&"string"==typeof e.choice&&(n=(0,l.disableChoice)(choice));break;case"displayTxt":void 0!==e.txt&&"string"==typeof e.txt&&((0,r.fadeOut)("container"),setTimeout(function(){(0,r.replaceById)("text",e.txt,0),(0,u.addToButtonQueue)("Continue","refresh","refreshLoc"),(0,u.createButtons)(),(0,r.fadeIn)("container")},r.fadeTime),n=!0);break;case"fadeOut":void 0!==e.id&&"string"==typeof e.id&&((0,r.fadeOut)(e.id),n=!0);break;case"increaseNpcComfort":(o=f.NpcList.get(e.npc))instanceof f.Npc&&void 0!==e.amount&&"number"==typeof e.amount&&(o.comfortLevel+=e.amount,n=!0);break;case"playSound":void 0!==e.url&&"string"==typeof e.url&&(s="story/audio/"+e.url,(d=(0,a.loadSound)(s))>=0&&(0,a.playSound)(d));break;case"refresh":I(),n=!0;break;case"removeSection":void 0!==(t=f.LocationList.get(e.loc))&&void 0!==t.content[e.section]&&"object"===i(t.content[e.section])&&(t.content.splice(e.section,1),n=!0);break;case"triggerCutscene":void 0!==e.cutscene&&"string"==typeof e.cutscene&&(loadCutscene("story/scenes/"+e.scene+".json"),(0,l.recordSceneChange)(),n=!0);break;case"triggerScene":void 0!==e.scene&&"string"==typeof e.scene&&(O("story/scenes/"+e.scene+".json"),(0,l.recordSceneChange)(),n=!0)}n&&void 0!==e.feedback&&"string"==typeof e.feedback?(p[h]=e.feedback,h+=1):n||L("consequence failed: "+e.type)}),p.length>0&&(0,r.compositFeedback)(p)},n.logError=L,n.Inventory=S},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.menuTracker=n.useOnModeActive=n.useOnMode=n.hideMenu=n.isMenuActive=n.refreshMenu=n.openMenu=n.openInventory=n.deactivateUseOnMode=n.createButtons=n.addToMenu=n.addToMenuTextQueue=n.addToMenuButtonQueue=n.addToButtonQueue=void 0;var o=t(1),i=t(3),a=t(5),c=t(4),s=t(0),r=[],u=!1,d="none",l=[],f=[],v=[],p=!1,h=!1,g=void 0,y=1,m=function(){return!!u},b=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},k=function(e,n,t,o,i){void 0===o&&(o="no"),void 0===i&&(i=-1),v.push([e,n,t,o,i])},S=function(e){f.push(e)},T=function(e){var n=(0,s.getObj)(e).ref;if(n.interactions.length>0){var t=0,i=!1;n.interactions.forEach(function(n){"take"===n.type&&n.activated&&(i=!0,k(n.button,e,"interact","no",t)),t+=1}),i||(t=0,n.interactions.forEach(function(i){"talk"===i.type&&(void 0===n.sceneQueue||n.sceneQueue.length<=0||o.player.inScene)||!i.activated||k(i.button,e,"interact","no",t),t+=1}))}},_=function(e){"string"==typeof e&&(d=e)},L=function(e){$(e.target).closest("#menu_container").length||m()&&M()},O=function(e,n){for(var t=!1,a=(0,s.getObj)(n),r=!1,u=0,v=0;u<l.length;){if(l[u]===n){t=!0;var p=l.length-1;if(u<p){var h=u+1,g=p-u;l.splice(h,g)}}u+=1}for(t||l.push(n);v<a.ref.interactions.length;){if("close"===a.ref.interactions[v].type){r=!0;break}v+=1}if(l.length>1){var y=l.length-2,m=l[y];r||(m===o.player.inventory.name?k("Back",m,"openInventory","no",-1):k("Back",m,"openMenu","no",-1))}e>0&&((0,i.fadeOut)("menu_info",e),(0,i.fadeOut)("menu_options",e)),setTimeout(function(){(0,i.replaceById)("menu_options","",0),(0,i.replaceById)("menu_title",d,0),(0,i.replaceById)("menu_info","",0),f.forEach(function(e){$("#menu_info").append("<p>"+(0,c.parse)(e)+"</p>")}),k("Close menu","closeButton","hideMenu"),B(),(0,o.updateDebugStats)(),e>0&&((0,i.fadeIn)("menu_info",e),(0,i.fadeIn)("menu_options",e))},e)},j=function(e){O(i.fadeTime/4,e)},I=function(e){u=!0,p=!0,(0,i.clearFeedback)(!1,!0),O(0,e),$("#menu_container").removeClass("hide"),setTimeout(function(){$("#menu_container").addClass("animate"),$("#container").addClass("blur")},50),setTimeout(function(){document.addEventListener("mouseup",L),p=!1},500)},M=function(){if(p=!0,document.removeEventListener("mouseup",L),$("#menu_container").removeClass("animate"),$("#container").removeClass("blur"),setTimeout(function(){p=!1,u||$("#menu_container").addClass("hide")},200),o.player.location===o.player.inventory.name&&setTimeout(function(){$("#inventoryBtn").on("click",function(){w()})},200),l.length>1)for(var e=1;e<l.length;)(0,s.getObj)(l[e]).ref.autoClose(),e+=1;u=!1,n.menuTracker=l=[],(0,o.updateDebugStats)(),o.player.inObject&&!o.player.inScene?(o.player.leaveMenu(o.player.locationNext),(0,o.updateDebugStats)(),(0,o.refreshLocation)()):o.player.inObject&&o.player.inScene&&(o.player.leaveMenu("locScene"),(0,o.updateDebugStats)())},x=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];h&&(n.useOnModeActive=h=!1,(0,i.clearFeedback)(!0,!0),(0,i.addFeedback)("'Use on' cancelled"),e&&(0,o.refreshLocation)())},C=function(e){var n=(0,s.getObj)(e).ref;setTimeout(function(){o.player.moveToMenu(e),void 0!==n&&(_(b(n.name)),S(n.descr),T(e),m()?j(e):I(e))},p?250:0)},w=function(){var e=void 0,n=o.player.inventory.name,t=s.ObjList.get(n);$("#inventoryBtn").off(),setTimeout(function(){o.player.moveToMenu(n),_(b(n)),S(t.descr),o.Inventory.forEach(function(n,t,o){n&&(e=s.ObjList.get(t),k(e.name,e.name,"openMenu","no",-1))}),m()?j(n):I(n),h&&x()},p?250:0)},B=function(){var e="choices",t=r;u&&(e="menu_options",t=v),(0,i.replaceById)(e,"",0),t.forEach(function(t){var c,r=t[0],u=t[1],d=t[2],l=t[3],f=t[4],v="std";c="no"===l||"string"!=typeof l?"btn"+y:l,y+=1;var p=s.LocationList.get(o.player.locationNext).styling.buttonClass;void 0!==p&&"string"==typeof p&&""!==p&&(v=p),"inline_button"!==r?(r=b(r),$("#"+e).append('<li><button id="'+c+'" class="'+v+'">'+r+"</button></li>")):!h||"directAction"!==d&&"openMenu"!==d||(d="useOn"),"changeLoc"===d?$("#"+c).click(function(){x(),(0,o.enterLocation)(u)}):"advanceScene"===d?$("#"+c).one("click",function(){x(),(0,a.advanceScene)(u)}):"hideMenu"===d?$("#"+c).one("click",function(){x(),M()}):"openMenu"===d?$("#"+c).click(function(){x(),C(u)}):"openInventory"===d?$("#"+c).one("click",function(){x(),w()}):"interact"===d?$("#"+c).click(function(){x();var e=s.ObjList.get(u);void 0===e&&(e=s.NpcList.get(u)),f>=0&&e.interact(f,!1)}):"directAction"===d?$("#"+c).click(function(){x(),(0,o.directAction)(u)}):"directChange"===d?$("#"+c).click(function(){x(),(0,o.change)(u)}):"refreshLoc"===d?$("#"+c).one("click",function(){x(),(0,o.refreshLocation)()}):"useOn"===d&&$("#"+c).one("click",function(){var e=s.ObjList.get(u);void 0===e&&(e=s.NpcList.get(u)),(0,i.clearFeedback)(!0,!0),e.receiveFromObj(g),n.useOnModeActive=h=!1,(0,o.refreshLocation)()})}),u?(f=[],v=[]):r=[]};n.default="loaded",n.addToButtonQueue=function(e,n,t,o,i){void 0===o&&(o="no"),void 0===i&&(i=-1),r.push([e,n,t,o,i])},n.addToMenuButtonQueue=k,n.addToMenuTextQueue=S,n.addToMenu=T,n.createButtons=B,n.deactivateUseOnMode=x,n.openInventory=w,n.openMenu=C,n.refreshMenu=j,n.isMenuActive=m,n.hideMenu=M,n.useOnMode=function(e){n.useOnModeActive=h=!0,g=e,M(),(0,i.addFeedback)('<a href="#" id="cancelUseOn">cancel</a> Use '+g+" on:",!0,!0)},n.useOnModeActive=h,n.menuTracker=l},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.toggleFullscreen=n.fadeOut=n.fadeIn=n.setFadeTime=n.setFeedbackTime=n.replaceById=n.compositFeedback=n.changeContainerClass=n.clearFeedback=n.addFeedback=n.setBgSize=n.changeBg=n.fadeTime=void 0;var o=t(0),i=t(2),a="contain",c="no_bg",s="std",r="std",u=1e3,d=5e3,l=[],f=!0,v=!1,p={bgClass:"std",img:"no_bg"},h={bgClass:"std",img:"no_bg"},g=function(e,n){(n<0||void 0===n)&&(n=u),$("#"+e).fadeTo(n,1)},y=function(e,n){(n<0||void 0===n)&&(n=u),$("#"+e).fadeTo(n,0)},m=function(e){var n=o.LocationList.get(e);if(n instanceof o.Location){var t=n.styling.containerClass;void 0!==t&&""!==t&&"string"==typeof t||(t="std"),t!==r&&($("#container").removeClass(r),$("#container").addClass(t),$("#menu_container").removeClass(r),$("#menu_container").addClass(t),r=t)}},b=function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"none";void 0===t&&0!==t&&(t=u),void 0!==o&&"string"==typeof o||(o="none"),t>0?(y(e,t),setTimeout(function(){$("#"+e).html(n),"none"!==o&&m(o),g(e,t)},t)):("none"!==o&&m(o),$("#"+e).html(n))},k=function(e){var n={msg:e,persist:arguments.length>1&&void 0!==arguments[1]&&arguments[1],useOnMode:arguments.length>2&&void 0!==arguments[2]&&arguments[2]};if(void 0!==e&&"string"==typeof e&&""!==e)if(l.length>0){var t=l.length-1;l[t].msg!==e&&l.push(n)}else l.push(n),S()},S=function e(){var n="feedback",t=l[0].msg,o=l[0].persist,a=l[0].useOnMode;(0,i.isMenuActive)()&&(n="menu_"+n),b(n,t,0),document.getElementById(n).style.opacity=1,a&&$("#cancelUseOn").one("click",function(){(0,i.deactivateUseOnMode)(!0)}),o||setTimeout(function(){l.splice(0,1),l.length>0?e():document.getElementById(n).style.opacity=0},d)};n.default="loaded",n.fadeTime=u,n.changeBg=function(e){var n=e.locImg,t=e.styling.bgClass;if(void 0!==t&&"string"==typeof t&&""!==t||(t="std"),t!==s||n!==c){var o;c=n,o="no_bg"===n?"none":"story/images/"+n,f?(t!==h.bgClass&&($("#bg_layer_bottom").removeClass(h.bgClass),$("#bg_layer_bottom").addClass(t),h.bgClass=t),n!==h.img&&("none"===o?($("#bg_layer_bottom").css("background","none"),$("#bg_layer_bottom").css({"background-color":""})):($("#bg_layer_bottom").css("background","url('"+o+"') top center no-repeat"),$("#bg_layer_bottom").css({"background-color":""}),$("#bg_layer_bottom").css("background-size",a)),h.img=n),document.getElementById("bg_layer_top").style.opacity=0,f=!1):(t!==p.bgClass&&($("#bg_layer_top").removeClass(p.bgClass),$("#bg_layer_top").addClass(t),p.bgClass=t),n!==p.img&&("none"===o?($("#bg_layer_top").css("background","none"),$("#bg_layer_top").css({"background-color":""})):($("#bg_layer_top").css("background","url('"+o+"') top center no-repeat"),$("#bg_layer_top").css({"background-color":""}),$("#bg_layer_top").css("background-size",a)),p.img=n),document.getElementById("bg_layer_top").style.opacity=1,f=!0),s=t}},n.setBgSize=function(e){a=e},n.addFeedback=k,n.clearFeedback=function(e,n){e&&(document.getElementById("feedback").style.opacity=0),n&&(document.getElementById("menu_feedback").style.opacity=0),feedbackActive=!1},n.changeContainerClass=m,n.compositFeedback=function(e){var n="",t=!1;if(e.length>0)for(var o=0,i=void 0;o<e.length;)"no_msg"!==(i=e[o])&&(t=!0,n+=i,o<e.length-1&&(n+="<br>")),o++;t&&k(n)},n.replaceById=b,n.setFeedbackTime=function(e){"number"==typeof e&&e>0&&e<5e4&&(d=e)},n.setFadeTime=function(e){"number"==typeof e&&e>0&&e<5e3&&(n.fadeTime=u=e)},n.fadeIn=g,n.fadeOut=y,n.toggleFullscreen=function(){if(!v&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){v=!0,$("#fsBtn").removeClass("fs_enter"),$("#fsBtn").addClass("fs_exit");var e=document.querySelector("body");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}else v&&(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(v=!1,$("#fsBtn").removeClass("fs_exit"),$("#fsBtn").addClass("fs_enter"),document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen())}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.parseLocation=n.parse=void 0;var o=t(2),i=t(0),a=t(1),c=1,s=void 0,r=function(e){var n=!1,t=!1,a=!1,r=void 0,u=void 0,d=void 0,l=void 0,f=void 0,v=void 0,p={buttonTxt:"none",strt:0,end:0,lngth:0},h={objID:"none",strt:0,end:0,lngth:0};do{if(n=!1,t||(u=e.search(/\[{2}/),d=e.search(/\]{2}/)+2,u>-1&&d>1&&d>u?(l=d-u,f=e.substr(u,l),p.end=f.search(/->/),p.end>-1?(n=!0,h.strt=p.end+2,p.lngth=p.end-2,h.end=f.search(/\]{2}/),h.lngth=h.end-h.strt,p.buttonTxt=f.substr(2,p.lngth),h.objID=f.substr(h.strt,h.lngth),(0,o.isMenuActive)()?(0,o.addToMenuButtonQueue)(p.buttonTxt,h.objID,"changeLoc","no",-1):(0,o.addToButtonQueue)(p.buttonTxt,h.objID,"changeLoc","no",-1),e=e.replace(f,"")):t=!0):t=!0),!a)if(r=!1,u=e.search(/\{{2}/),d=e.search(/\}{2}/)+2,u>-1&&d>1&&d>u){var g=!1;if(n=!0,l=d-u,f=e.substr(u,l),p.strt=2,2===f.search(/\!/)&&(r=!0,p.strt+=1),f.search(/\@/)===l-3&&(g=!0,v=""),p.end=f.search(/->/),-1===p.end||void 0===p.end?(p.end=f.search(/\}{2}/),g&&(p.end-=1),p.lngth=p.end-p.strt,h.objID=f.substr(p.strt,p.lngth)):(h.strt=p.end+2,h.end=f.search(/\}{2}/),g&&(h.end-=1),h.lngth=h.end-h.strt,h.objID=f.substr(h.strt,h.lngth)),p.lngth=p.end-p.strt,p.buttonTxt=f.substr(p.strt,p.lngth),(0,o.isMenuActive)()){var y=i.ObjList.get(h.objID),m=i.NpcList.get(h.objID);void 0!==m&&(y=m),void 0!==y&&("player"!==y.loc?(v=p.buttonTxt,(0,o.addToMenu)(h.objID)):v="")}else g?r?(0,o.addToButtonQueue)(p.buttonTxt,h.objID,"directAction","no",-1):(0,o.addToButtonQueue)(p.buttonTxt,h.objID,"openMenu","no",-1):(s="inlBtn"+c,c+=1,v=o.useOnModeActive?'<a href="#" id='+s+' class="useOn">'+p.buttonTxt+"</a>":'<a href="#" id='+s+">"+p.buttonTxt+"</a>",r?(0,o.addToButtonQueue)("inline_button",h.objID,"directAction",s,-1):(0,o.addToButtonQueue)("inline_button",h.objID,"openMenu",s,-1));e=e.replace(f,v)}else a=!0}while(n);return e};n.default="loaded",n.parse=r,n.parseLocation=function(e){var n=[];return e.forEach(function(e){var t=void 0,i=void 0,u=void 0,d=void 0,l=void 0,f=e.sectionHTML,v=void 0,p=void 0,h=!1,g=!1;if(e.conditions.length>0&&(u=f.search(/\({2}/),d=f.search(/\){2}/),u>-1&&d>1&&d>u?(l=(d+=2)-u,t=f.substr(u,l),l=(d-=2)-(u+=2),v=f.substr(u,l)):(v=f,t=f,h=!0),(0,a.checkConditions)(e.conditions)?f=f.replace(t,v):(f=f.replace(t,""),h&&(g=!0,void 0!==e.fallback&&""!==e.fallback&&(f=e.fallback)))),e.consequences.length>0&&!g){var y=!1;if(u=-1,d=-1,u=f.search(/\(\{/),d=f.search(/\}\)/),u>-1&&d>1&&d>u?(l=(d+=2)-u,(i=f.substr(u,l)).search(/\@/)===l-3&&(y=!0,d-=1),l=(d-=2)-(u+=2),p=f.substr(u,l)):(p=f,i=f),p.length>0)if(y)f=f.replace(i,""),(0,o.addToButtonQueue)(p,e.consequences,"directChange","no",-1);else{var m;s="inlBtn"+c,c+=1,m='<a href="#" id='+s+">"+p+"</a>",f=f.replace(i,m),(0,o.addToButtonQueue)("inline_button",e.consequences,"directChange",s,-1)}}f=r(f);var b=0;void 0!==e.delay&&"number"==typeof e.delay&&e.delay>0&&(b=e.delay);var k={sectionHTML:f,delay:b};n.push(k)}),n}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.advanceScene=n.startScene=n.disableChoice=n.recordSceneChange=n.sceneChanged=void 0;var o=t(1),i=t(3),a=t(2),c=t(0),s=t(4),r=!1,u={},d=function(e){var n,t=!1,d=!1,l=void 0;if((0,o.updateDebugStats)(),(0,a.isMenuActive)()&&(0,a.hideMenu)(),o.player.inScene=!0,(0,o.updateDebugStats)(),(0,i.fadeOut)("text"),(0,i.fadeOut)("choices"),(n=u[e].responses).length>0){for(var f=0,v=void 0;f<n.length&&!t;)void 0!==(v=n[f].conditions)?(0,o.checkConditions)(v,!1)&&(l=n[f],t=!0):t=!0,f+=1;t&&(setTimeout(function(){(0,i.replaceById)("text",(0,s.parse)(l.response),0,o.player.locationNext)},i.fadeTime),"string"==typeof l.response&&""!==l.response&&(d=!0))}if("start"!==e){var p=u[e].consequences;(0,o.change)(p)}if((0,o.updateDebugStats)(),o.player.location!==o.player.locationNext&&!r&&o.player.inScene)if(t){var h=l.newChoices;if(0===h.length&&d){var g=o.player.locationNext;(0,a.addToButtonQueue)("Continue",g,"changeLoc",g),setTimeout(function(){(0,a.createButtons)()},i.fadeTime)}else h.forEach(function(e){u[e].enabled&&(0,a.addToButtonQueue)(u[e].choice,e,"advanceScene",e)}),setTimeout(function(){(0,a.createButtons)()},i.fadeTime);setTimeout(function(){(0,i.fadeIn)("text"),(0,i.fadeIn)("choices")},i.fadeTime)}else"In scene"===c.LocationList.get(o.player.location).name&&(0,o.enterLocation)(o.player.locationNext)};n.default="loaded",n.sceneChanged=r,n.recordSceneChange=function(){n.sceneChanged=r=!0},n.disableChoice=function(e){return void 0!==u[e].enabled&&"boolean"==typeof u[e].enabled?(u[e].enabled=!1,!0):(console.log("Error: scene.js/disableChoice: choice not found"),!1)},n.startScene=function(e){o.player.setLocation("locScene"),o.player.setInObject(!1),u=e,n.sceneChanged=r=!1,d("start")},n.advanceScene=d},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.playSound=n.loadSound=n.createSoundObj=n.getAudioTrack=n.soundMuted=n.setCurrentTrack=n.setAudioFadeTime=n.muteSound=n.initAudio=n.changeTrack=n.isPlayingAudio=void 0;var o=t(1),i=t(0),a=!1,c=[],s=[],r={filename:"no_sound"},u=!1,d=1e3,l=function(){r.howl.volume(0),r.howl.play(),r.howl.fade(0,1,d),$("#soundInfo").text("playing "+r.filename),n.isPlayingAudio=u=!0},f=function(){var e=r;$("#soundInfo").text("fading out"),"no_sound"!==e.filename&&(e.howl.fade(1,0,d),setTimeout(function(){e.howl.pause(),$("#soundInfo").text("playback paused")},d)),n.isPlayingAudio=u=!1},v=function(e){var n=r;r=e,a||r.howl.play(),$("#soundInfo").text("track changed: "+e.filename),console.log("Starting playback for "+r.filename),a||n.filename===e.filename||"no_sound"===n.filename?a||n.filename===e.filename||"no_sound"!==n.filename?a&&n.filename!==e.filename&&$("#soundInfo").text("sound is muted, only updated currentTrack"):($("#soundInfo").text("fade in"),l()):(n.howl.fade(1,0,d),r.howl.fade(0,1,d),setTimeout(function(){n.howl.pause()},2e3))},p=function(e,n){return a&&(n=!1),new Howl({src:[e],loop:!1,volume:1,preload:n})};n.default="loaded",n.isPlayingAudio=u,n.changeTrack=function(e){if(e!==r.filename)if("no_sound"!==e){for(var n=!1,t=void 0,i=0;i<c.length&&!n;)c[i].filename===e&&(n=!0,t=i),i+=1;if(n&&!a){var s=c[t];"unloaded"===s.howl.state()?(s.howl.load(),s.howl.once("load",function(){v(s)})):"loading"===s.howl.state()?s.howl.once("load",function(){v(s)}):v(s)}else n&&a&&(r=c[t])}else a||f(),setTimeout(function(){r={filename:"no_sound",audioElement:null},(0,o.updateDebugStats)(),$("#soundInfo").text("playback stopped")},d)},n.initAudio=function(e){i.LocationList.forEach(function(n){var t=!1;if("no_sound"!==n.locSnd){for(var o=!1,i=0;i<c.length;){if(c[i].filename===n.locSnd){o=!0;break}i+=1}if(!o){var s="story/audio/"+n.locSnd;a||e.forEach(function(e){s===(e="story/audio/"+e)&&(t=!0,console.log("Preloading "+s))});var r=new Howl({src:[s],loop:!0,volume:0,preload:t}),u={filename:n.locSnd,howl:r};c.push(u)}}})},n.muteSound=function(){a?(n.soundMuted=a=!1,"no_sound"!==r.filename&&("loaded"===r.howl.state()?l():(r.howl.load(),r.howl.once("load",function(){l()}))),$("#soundBtn").removeClass("sound_off"),$("#soundBtn").addClass("sound_on")):(n.soundMuted=a=!0,"no_sound"!==r.filename&&f(),$("#soundBtn").removeClass("sound_on"),$("#soundBtn").addClass("sound_off"))},n.setAudioFadeTime=function(e){"number"==typeof e&&e>=0&&(d=e)},n.setCurrentTrack=function(e){r=e,n.isPlayingAudio=u=!0,$("#soundInfo").text("playing: "+r.filename)},n.soundMuted=a,n.getAudioTrack=function(e){for(var n=!1,t=void 0,o=0;o<c.length&&!n;)c[o].filename===e&&(n=!0,t=o),o+=1;return n?c[t]:null},n.createSoundObj=p,n.loadSound=function(e){for(var n=!1,t=void 0,i=0;i<s.length;){if(s[i].filename===e){n=!0,t=i;break}i+=1}if(!n){var a=/(?:\.([^.]+))?$/.exec(e)[1];if(void 0===a||"mp3"!==a&&"wav"!==a&&"ogg"!==a&&"aac"!==a&&"flac"!==a)(0,o.logError)("soundfile format not supported"),t=-1;else{var c={};c.filename=e,c.howl=p(e,!0),c.howl instanceof Howl?(s.push(c),t=i):((0,o.logError)("could not create new Howl sound object"),t=-1)}}return t},n.playSound=function(e){a||void 0===s[e]||s[e].howl.play()}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.startCutscene=void 0;var o=t(6),i=t(0),a=t(3),c=t(1);n.default="loaded",n.startCutscene=function(e){(0,a.fadeOut)("text",a.fadeTime),(0,a.fadeOut)("choices",a.fadeTime),e.forEach(function(e){if("no_sound"!==e.playSoundfile){var n="story/audio/"+e.playSoundfile;e.soundIndex=(0,o.loadSound)(n)}}),c.player.setLocation("locScene"),c.player.setInObject(!1),setTimeout(function(){$("#text").html(""),$("#choices").html(""),(0,a.fadeIn)("text",0),(0,a.fadeIn)("choices",0),(0,a.changeContainerClass)(c.player.locationNext),function e(n,t){var s="event_"+t.indexOf(n),r=n.duration+n.inAnim;if("no_sound"!==n.playSoundfile&&void 0!==n.soundIndex&&(0,o.playSound)(n.soundIndex),"add"===n.type)n.inAnim>=0&&($('<div id="'+s+'" class="cutscene">'+n.sectionHTML+"</div>").appendTo("#text").hide(),$("#"+s).fadeIn(n.inAnim));else{var u='<div id="'+s+'" class="cutscene">'+n.sectionHTML+"</div>";n.inAnim>0?($("#text").css("opacity",0),$("#text").html(u),(0,a.fadeIn)("text",n.inAnim)):$("#text").html(u)}setTimeout(function(){n.outAnim>0?$("#"+s).fadeOut(n.outAnim):0===n.outAnim&&$("#"+s).remove(),"fadeOutAll"===n.onEnd&&(0,a.replaceById)("text","",a.fadeTime),setTimeout(function(){var o=t.indexOf(n);o<t.length-1?e(t[o+1],t):"In scene"===i.LocationList.get(c.player.location).name&&(0,c.enterLocation)(c.player.locationNext)},n.outAnim)},r)}(e[0],e)},a.fadeTime)}},function(e,n,t){e.exports=t(1)}]);